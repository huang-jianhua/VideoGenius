# 本地视频素材使用说明

## 📁 当前配置状态

你已经成功配置项目使用本地视频素材：
```toml
video_source = "local"
```

## 🎬 支持的文件格式

### ✅ 推荐格式
- **视频文件**: `.mp4`, `.avi`, `.mov`, `.mkv`
- **图片文件**: `.jpg`, `.jpeg`, `.png` (会自动转换为视频)

### ⚠️ 注意事项
1. **分辨率要求**: 最低480x480像素
2. **文件命名**: 避免中文文件名，建议使用英文
3. **文件大小**: 建议单个文件不超过100MB

## 📂 素材存放位置

本地素材应放在以下目录：
```
VideoGenius/
├── storage/
│   └── local_videos/          # 本地视频素材目录
│       ├── video1.mp4
│       ├── video2.mp4
│       ├── image1.jpg
│       └── image2.png
```

## 🔧 最新解决的问题 (2025-05-27)

### 问题描述
在视频生成过程中遇到多个PNG文件导致的错误：
1. **第一次错误**: `图片1.png` (764x387分辨率)
2. **第二次错误**: `图片5.png` (1780x394分辨率)

**错误信息**:
```
OSError: MoviePy error: failed to read the duration of file 'xxx_图片X.png'
```

### 根本原因
1. PNG图片分辨率不符合最低要求(480x480)
2. MoviePy无法正确读取PNG文件的时长信息
3. 系统中存在多个重复的PNG文件

### 解决方案
1. ✅ **清理所有PNG文件**: 删除`storage/local_videos/`目录下所有PNG文件
2. ✅ **保留转换后的MP4**: 只保留已经成功转换的`.mp4`文件
3. ✅ **服务重启**: 重新启动Streamlit服务

**执行的命令**:
```bash
del "storage\local_videos\*.png"
py -m streamlit run webui/Main.py --browser.gatherUsageStats=False --server.enableCORS=True
```

## 🎯 使用建议

### 1. 准备高质量素材
```bash
# 推荐的视频规格
- 分辨率: 1080x1920 (竖屏) 或 1920x1080 (横屏)
- 格式: MP4 (H.264编码)
- 时长: 5-30秒
- 帧率: 25-30fps
```

### 2. 素材命名规范
```bash
# 好的命名示例
running_exercise_01.mp4
sports_recovery_02.mp4
fitness_training_03.jpg

# 避免的命名
图片1.png
视频素材.mp4
运动康复 视频.mp4
```

### 3. 素材分类管理
```
storage/local_videos/
├── sports/              # 运动类素材
│   ├── running_01.mp4
│   └── fitness_02.mp4
├── health/              # 健康类素材
│   ├── recovery_01.mp4
│   └── therapy_02.mp4
└── general/             # 通用素材
    ├── background_01.mp4
    └── transition_02.mp4
```

## 🚀 当前服务状态

- **Web界面**: ✅ 运行中 (http://localhost:8501)
- **端口监听**: ✅ 8501端口正常
- **配置模式**: ✅ 本地素材模式
- **AI模型**: ✅ 硅基流动DeepSeek-V3已配置
- **素材状态**: ✅ 已清理问题文件，只保留有效MP4

## 🎬 视频生成流程

使用本地素材时的生成流程：

1. **AI文案生成** ✅
   - 根据主题生成视频文案
   - 提取关键词用于素材匹配

2. **语音合成** ✅
   - 将文案转换为语音
   - 支持多种中文语音

3. **素材处理** ✅
   - 自动处理本地图片/视频
   - 调整分辨率和时长
   - 转换格式以适配项目需求

4. **视频合成** 🎯
   - 将素材、语音、字幕合成
   - 生成最终视频文件

## 🔍 故障排除

### 常见问题及解决方案

#### 1. PNG文件处理错误 ⚠️ **已解决**
**错误**: `MoviePy error: failed to read the duration of file 'xxx.png'`
**原因**: 
- PNG文件分辨率过低
- MoviePy无法读取PNG文件时长信息
- 存在重复的问题文件

**解决**: 
- ✅ 删除所有PNG文件: `del "storage\local_videos\*.png"`
- ✅ 使用已转换的MP4文件
- ✅ 重启服务

#### 2. 图片分辨率过低
**错误**: `low resolution material: 764x387, minimum 480x480 required`
**解决**:
- 确保图片分辨率 ≥ 480x480
- 使用JPG格式替代PNG
- 检查文件是否损坏

#### 3. 视频分辨率过低
**警告**: `low resolution material: 764x387, minimum 480x480 required`
**解决**:
- 使用更高分辨率的素材
- 推荐使用1080p或以上分辨率

#### 4. 文件路径问题
**错误**: 文件路径包含中文字符
**解决**:
- 重命名文件为英文
- 避免使用特殊字符和空格

## 📊 性能优化建议

1. **素材预处理**
   - 提前将图片转换为MP4格式
   - 统一视频分辨率和帧率
   - 压缩文件大小以提高处理速度

2. **存储管理**
   - 定期清理临时文件
   - 备份重要素材
   - 监控磁盘空间使用

3. **批量处理**
   - 一次准备多个素材
   - 使用脚本批量重命名
   - 建立素材库分类体系

## 🎉 问题解决完成！

**最新状态** (2025-05-27 15:00):
- ✅ 清理了所有有问题的PNG文件
- ✅ 保留了8个有效的MP4文件
- ✅ 服务重新启动成功 (PID: 24964)
- ✅ 8501端口正常监听

现在你可以：
1. 访问 http://localhost:8501 继续使用
2. 重新测试"跑步运动康复"视频生成
3. 准备更多高质量的本地素材

如果还有问题，随时告诉我！ 