# 项目迁移指南 📋

本指南将帮助你将当前MoneyPrinterTurbo项目中的修改内容迁移到你新fork的项目中。

## 🎯 迁移概述

### 当前项目的重要修改
1. **AI模型配置** - 硅基流动DeepSeek-V3 API
2. **视频素材源** - 配置为本地素材模式
3. **项目文档** - 创建了详细的使用说明文档
4. **环境配置** - 解决了依赖包兼容性问题

## 📁 需要迁移的文件

### 1. 配置文件
- `config.toml` - 主要配置文件

### 2. 文档文件
- `启动说明.md` - 项目启动指南
- `本地素材使用说明.md` - 本地素材使用指南
- `项目迁移指南.md` - 本文档

### 3. 素材文件
- `storage/local_videos/` - 本地视频素材（可选）

## 🚀 迁移步骤

### 步骤1：复制配置文件

将以下配置内容复制到新项目的 `config.toml` 文件中：

```toml
[app]
video_source = "local"
hide_config = false
pexels_api_keys = []
pixabay_api_keys = []
llm_provider = "openai"
pollinations_api_key = ""
pollinations_base_url = "https://pollinations.ai/api/v1"
pollinations_model_name = "openai-fast"
ollama_base_url = ""
ollama_model_name = ""
openai_api_key = "sk-ktuflbyyozyoyrznigqkutyiwqhdpttsarpesiahxmwkikvz"
openai_base_url = "https://api.siliconflow.cn/v1"
openai_model_name = "Pro/deepseek-ai/DeepSeek-V3"
moonshot_api_key = ""
moonshot_base_url = "https://api.moonshot.cn/v1"
moonshot_model_name = "moonshot-v1-8k"
oneapi_api_key = ""
oneapi_base_url = ""
oneapi_model_name = ""
g4f_model_name = "gpt-3.5-turbo"
azure_api_key = ""
azure_base_url = ""
azure_model_name = "gpt-35-turbo"
azure_api_version = "2024-02-15-preview"
gemini_api_key = ""
gemini_model_name = "gemini-1.0-pro"
qwen_api_key = ""
qwen_model_name = "qwen-max"
deepseek_api_key = ""
deepseek_base_url = "https://api.deepseek.com"
deepseek_model_name = "deepseek-chat"
subtitle_provider = "edge"
endpoint = ""
material_directory = ""
enable_redis = false
redis_host = "localhost"
redis_port = 6379
redis_db = 0
redis_password = ""
max_concurrent_tasks = 5

[whisper]
model_size = "large-v3"
device = "CPU"
compute_type = "int8"

[proxy]

[azure]
speech_key = ""
speech_region = ""

[siliconflow]
api_key = ""

[ui]
hide_log = false
language = "zh"
tts_server = "azure-tts-v1"
voice_name = "zh-CN-XiaoxiaoNeural-Female"
font_name = "MicrosoftYaHeiBold.ttc"
text_fore_color = "#FFFFFF"
font_size = 60
```

### 步骤2：复制文档文件

将以下文档文件复制到新项目根目录：
- `启动说明.md`
- `本地素材使用说明.md`
- `项目迁移指南.md`

### 步骤3：设置Python环境

在新项目中安装依赖包：

```bash
# 安装基础依赖
pip install streamlit fastapi uvicorn loguru openai moviepy

# 安装语音相关
pip install edge-tts==6.1.19

# 安装其他依赖
pip install faster-whisper g4f

# 如果遇到版本冲突，可以逐个安装并解决
```

### 步骤4：创建目录结构

确保新项目有以下目录结构：

```
NewProject/
├── storage/
│   ├── local_videos/          # 本地视频素材目录
│   └── tasks/                 # 生成的视频任务
├── config.toml                # 配置文件
├── 启动说明.md               # 启动指南
├── 本地素材使用说明.md       # 素材使用指南
└── 项目迁移指南.md           # 迁移指南
```

### 步骤5：迁移素材文件（可选）

如果你有准备好的本地视频素材，可以复制到新项目：

```bash
# 复制MP4文件（推荐）
copy "storage\local_videos\*.mp4" "新项目路径\storage\local_videos\"
```

## 🔧 快速迁移脚本

创建以下批处理脚本 `migrate.bat` 来快速迁移：

```bat
@echo off
echo 项目迁移脚本开始执行...

set SOURCE_DIR=D:\mycode\other\MoneyPrinterTurbo
set TARGET_DIR=%1

if "%TARGET_DIR%"=="" (
    echo 请提供目标项目路径
    echo 用法: migrate.bat "目标项目路径"
    pause
    exit /b 1
)

echo 复制配置文件...
copy "%SOURCE_DIR%\config.toml" "%TARGET_DIR%\" /Y

echo 复制文档文件...
copy "%SOURCE_DIR%\启动说明.md" "%TARGET_DIR%\" /Y
copy "%SOURCE_DIR%\本地素材使用说明.md" "%TARGET_DIR%\" /Y
copy "%SOURCE_DIR%\项目迁移指南.md" "%TARGET_DIR%\" /Y

echo 创建必要目录...
if not exist "%TARGET_DIR%\storage\local_videos" mkdir "%TARGET_DIR%\storage\local_videos"
if not exist "%TARGET_DIR%\storage\tasks" mkdir "%TARGET_DIR%\storage\tasks"

echo 复制MP4素材文件...
if exist "%SOURCE_DIR%\storage\local_videos\*.mp4" (
    copy "%SOURCE_DIR%\storage\local_videos\*.mp4" "%TARGET_DIR%\storage\local_videos\" /Y
    echo 素材文件复制完成
) else (
    echo 未找到MP4素材文件
)

echo 迁移完成！
echo.
echo 下一步操作：
echo 1. 进入新项目目录: cd "%TARGET_DIR%"
echo 2. 安装依赖: pip install -r requirements.txt
echo 3. 启动项目: py -m streamlit run webui/Main.py
pause
```

使用方法：
```bash
migrate.bat "你的新项目路径"
```

## ✅ 迁移验证

迁移完成后，进行以下验证：

### 1. 配置验证
```bash
# 启动项目
py -m streamlit run webui/Main.py --browser.gatherUsageStats=False --server.enableCORS=True

# 检查AI模型是否正常工作
# 在Web界面测试文案生成功能
```

### 2. 素材验证
```bash
# 检查本地素材目录
dir storage\local_videos\*.mp4

# 测试视频生成功能
```

### 3. 功能验证
- [ ] AI文案生成正常
- [ ] 语音合成正常
- [ ] 本地素材读取正常
- [ ] 视频生成完整流程正常

## 🐛 常见问题及解决

### 问题1：依赖包版本冲突
**解决方案**：
```bash
pip install edge-tts==6.1.19
# 如果还有冲突，逐个安装并指定版本
```

### 问题2：API Key失效
**解决方案**：
- 检查硅基流动API Key是否有效
- 确认配置文件中的API配置正确

### 问题3：本地素材路径问题
**解决方案**：
- 确保 `storage/local_videos/` 目录存在
- 检查素材文件格式和分辨率

## 📝 迁移后的项目结构

```
YourNewProject/
├── app/                       # 核心应用代码
├── webui/                     # Web界面
├── storage/
│   ├── local_videos/          # ✅ 本地视频素材
│   └── tasks/                 # ✅ 生成的视频任务
├── resource/                  # 资源文件
├── config.toml               # ✅ 已配置的配置文件
├── requirements.txt          # 依赖包列表
├── README.md                 # 项目说明
├── 启动说明.md              # ✅ 启动指南
├── 本地素材使用说明.md      # ✅ 素材使用指南
└── 项目迁移指南.md          # ✅ 本文档
```

## 🎉 迁移完成

恭喜！按照以上步骤，你应该已经成功将所有重要的修改迁移到新的fork项目中。

现在你可以：
1. 在新项目中继续开发
2. 提交你的修改到Git仓库
3. 添加新功能和改进
4. 与原项目保持同步更新

如果在迁移过程中遇到任何问题，可以参考各个说明文档或随时寻求帮助！ 